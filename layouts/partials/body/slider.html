{{- if isset .Site.Params "slider" -}}
  {{- if .Site.Params.slider.enable -}}
    {{- $data_slides := slice -}}
    {{- if .Site.Data.slider -}}
      {{- range .Site.Data.slider -}}
        {{- if and (isset . "banner") (not (eq .banner "")) -}}
          {{- $data_slides = $data_slides | append . -}}
        {{- end -}}
      {{- end -}}
    {{- end -}}

    {{- $post_slides := slice -}}
    {{- if and (isset $.Site.Params.slider "manual") ($.Site.Params.slider.manual) -}}
      {{- range .Site.Pages.ByParam "slide" }}
        {{- if .Params.slide -}}
          {{- if and (isset .Params "banner") (not (eq .Params.banner "")) -}}
            {{- $post_slides = $post_slides | append . -}}
          {{- end -}}
        {{- end -}}
      {{- end -}}
    {{- else -}}
      {{- $features := add .Site.Params.slider.num_features 1 -}}
      {{- range first $features (where .Site.Pages "Type" "posts") -}}
        {{- if and (isset .Params "banner") (not (eq .Params.banner "")) -}}
          {{- $post_slides = $post_slides | append . -}}
        {{- end -}}
      {{- end -}}
    {{- end -}}

    {{- if and (or $post_slides $data_slides) (gt (math.Add (len $post_slides) (len $data_slides)) 1) -}}
    <section class="featured-slider">
      <div class="slider-cycle">
        {{- range $index, $slide := $data_slides -}}
          <div class="slides {{ if eq $index 0 }} displayblock {{ else }} displaynone {{ end }}">
            {{/* TODO: set "_blank" as option? ("isExternalLink") */}}
            <a class="slide-textbox" href="{{ $slide.url }}" title="{{ $slide.Title }}" target="_blank">
              <figure>
                <img src="{{ $slide.banner | absURL }}"
                     class="pngfix wp-post-image {{ if $.Site.Params.sliderInitZoom }}initzoom{{ end }} {{ if $.Site.Params.sliderZoom }}zoom{{ end }}"
                     alt="{{ $slide.Title }}"
                     title="{{ $slide.Title }}" />
                {{ if or $slide.caption $slide.copyright }}
                <figcaption class="image__text">
                  {{ if $slide.caption }}
                    <p class="inline-caption">{{ $slide.caption | markdownify }}{{ if $slide.copyright }}&nbsp;&ndash;{{ end }}</p>
                  {{ end }}
                  {{ with $slide.copyright }}
                    <p class="inline-copyright">{{ . | markdownify }}</p>
                  {{ end }}
                </figcaption>
                {{ end }}
              </figure>
              <article class="featured-text">
                <h4 class="featured-title">{{ $slide.Title }}</h4>
                <div class="featured-content">{{ printf "%s" $slide.Summary | markdownify }}</div>
              </article>
            </a>
          </div>
        {{- end -}}
        {{- range $index, $slide := $post_slides -}}
          <div class="slides {{ if eq $index 0 }} displayblock {{ else }} displaynone {{ end }}">
            {{ partial "body/single_slide" $slide }}
          </div>
        {{- end -}}
      </div>
      <button id="controllerPrev" class="controllerButton">{{ partial "svgs/arrow/arrow-left.svg" (dict "width" 24 "height" 24) }}</button>
      <button id="controllerNext" class="controllerButton">{{ partial "svgs/arrow/arrow-right.svg" (dict "width" 24 "height" 24) }}</button>
      <nav id="controllers" class="clearfix">
	  </nav>
    </section>
    <script type='text/javascript'>
      {{ $transition_effect := "fade" }}
      {{ if isset $.Site.Params.slider "transition_effect" }}
        {{ $transition_effect = $.Site.Params.slider.transition_effect }}
      {{ end }}
      {{ $transition_delay := 4000 }}
      {{ if isset $.Site.Params.slider "transition_delay" }}
        {{ $transition_delay = $.Site.Params.slider.transition_delay }}
      {{ end }}
      {{ $transition_duration := 1000 }}
      {{ if isset $.Site.Params.slider "transition_duration" }}
        {{ $transition_duration = $.Site.Params.slider.transition_duration }}
      {{ end }}
      var transition_effect = {{ $transition_effect }};
      var transition_delay = "{{ $transition_delay }}";
      var transition_duration = "{{ $transition_duration }}";
      var slider_value = { "transition_effect": transition_effect, "transition_delay": transition_delay, "transition_duration": transition_duration };
    </script>
    {{ $jquery := resources.Get "js/jquery.min.js" | resources.Fingerprint }}
    <script defer type='text/javascript' src="{{ $jquery.RelPermalink }}"></script>
    {{ $jqueryCycle := resources.Get "js/jquery.cycle.all.min.js" | resources.Fingerprint }}
    <script defer type='text/javascript' src="{{ $jqueryCycle.RelPermalink }}"></script>
    {{ $slider := resources.Get "js/slider-settings.min.js" | resources.Fingerprint }}
    <script defer type='text/javascript' src="{{ $slider.RelPermalink }}"></script>
    {{- end -}}
  {{ end }}
{{ end }}
