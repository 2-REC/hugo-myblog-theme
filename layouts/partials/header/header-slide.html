
{{ $context := .context }}
{{ $type := .type }}

{{ if $context.Params.header }}
  <section class="featured-slider">
    <div class="slider-cycle-header">

TODO:
- change header types to single/multi (instead of text/img/slides)
  => multi has fields slides+options (as-is), single is same as img (can have image or not)
- adapt _index.md (en+fr)
- adapt header archetype
- delete header-text.html
- delete header-img.html
- clean site-header.html

{{/*
      {{ range $.Params.header }}
        {{ if eq .type "slide" }}
          {{ $height := .height }}
          {{ range .slide }}
*/}}
      {{ range $context.Params.header }}
        {{ if eq .type $type }}
          {{ $height := .height }}
          {{ $slides := slice . }}
          {{ if eq .type "slide" }}
            {{ $slides = .slide }}
          {{ end }}
          {{ range $slides }}


            <div class="site-header__align-{{ .alignX }}" data-ani="{{ $.Site.Params.enableUiAnimation | default "true" }}" style="{{ if .imageSrc }}background-image: url('{{ .imageSrc | relURL }}'); background-size: {{ .imageSize }}; background-repeat: {{ .imageRepeat }}; background-position: {{ .imagePosition }};{{ end }} height: {{ $height }}px;">
              {{ $header := . }}

              {{/* X Padding */}}
              {{ if eq $header.alignX "left" }}
                <div style="padding-left: {{ $header.paddingX }}; height: 100%;">
              {{ else if eq .alignX "right" }}
                <div style="padding-right: {{ $header.paddingX }}; height: 100%;">
              {{ else }}
                {{ $sign := substr $header.paddingX 0 1 }}
                {{ if eq $sign "-" }}
                  <div style="padding-right: {{ substr $header.paddingX 1 }}; height: 100%;">
                {{ else }}
                  <div style="padding-left: {{ $header.paddingX }}; height: 100%;">
                {{ end }}
              {{ end }}

              {{/* Y Align/Padding */}}
              {{ if eq $header.alignY "top" }}
                {{ if ne $header.paddingY 0 }}
                  <div style="height: {{ $header.paddingY }}; opacity: 0;">-</div>
                {{ end }}
              {{ else }}
                {{ $heightPercent := 0 }}
                {{ $heightPixel := 0 }}
                {{ if .title }}
                  {{ range .title }}
                    {{ with $header.titleFontSize }}
                      {{ $array := partial "header/convert-value.html" . }}
                      {{ $heightPercent = add $heightPercent (index $array 0) }}
                      {{ $heightPixel = add $heightPixel (index $array 1) }}
                      {{/* TODO: remove when bug fixed */}}
                      {{ if ne (index $array 0) 0 }}
                        {{ printf "'%v' unit for font-size incorrectly handled -> Use 'px' instead" "%" }}
                      {{ end }}
                    {{ end }}
                    {{ with $header.titlePaddingY }}
                      {{ $array := partial "header/convert-value.html" . }}
                      {{ $heightPercent = add $heightPercent (index $array 0) }}
                      {{ $heightPercent = add $heightPercent (index $array 0) }}
                      {{ $heightPixel = add $heightPixel (index $array 1) }}
                      {{ $heightPixel = add $heightPixel (index $array 1) }}
                    {{ end }}
                  {{ end }}
                {{ end }}
                {{ with .spaceBetweenTitleSubtitle }}
                  {{ $array := partial "header/convert-value.html" . }}
                  {{ $heightPercent = add $heightPercent (index $array 0) }}
                  {{ $heightPixel = add $heightPixel (index $array 1) }}
                {{ end }}
                {{ if .subtitle }}
                  {{ range .subtitle }}
                    {{ with $header.subtitleFontSize }}
                      {{ $array := partial "header/convert-value.html" . }}
                      {{ $heightPercent = add $heightPercent (index $array 0) }}
                      {{ $heightPixel = add $heightPixel (index $array 1) }}
                      {{/* TODO: remove when bug fixed */}}
                      {{ if ne (index $array 0) 0 }}
                        {{ printf "'%v' unit for font-size incorrectly handled -> Use 'px' instead" "%" }}
                      {{ end }}
                    {{ end }}
                    {{ with $header.subtitlePaddingY }}
                      {{ $array := partial "header/convert-value.html" . }}
                      {{ $heightPercent = add $heightPercent (index $array 0) }}
                      {{ $heightPercent = add $heightPercent (index $array 0) }}
                      {{ $heightPixel = add $heightPixel (index $array 1) }}
                      {{ $heightPixel = add $heightPixel (index $array 1) }}
                    {{ end }}
                  {{ end }}
                {{ end }}
                {{ $paddingPercent := 0 }}
                {{ $paddingPixel := 0 }}
                {{ with $header.paddingY }}
                  {{ $array := partial "header/convert-value.html" . }}
                  {{ $paddingPercent = (index $array 0) }}
                  {{ $paddingPixel = (index $array 1) }}
                {{ end }}
                {{ if eq $header.alignY "bottom" }}
                  {{ $heightPercent = add $heightPercent $paddingPercent }}
                  {{ $heightPixel = add $heightPixel $paddingPixel }}
                  <div style="height: calc(100% - {{ $heightPercent }}% - {{ $heightPixel }}px); opacity: 0;">-</div>
                {{ else }}
                  {{ $heightPercent = sub (div $heightPercent 2) $paddingPercent }}
                  {{ $heightPixel = sub (div $heightPixel 2) $paddingPixel }}
                  <div style="height: calc(50% - {{ $heightPercent }}% - {{ $heightPixel }}px); opacity: 0;">-</div>
                {{ end }}
              {{ end }}

              {{/* Title */}}
              {{ if .title }}
                {{ $percentPadY := 0 }}
                {{ with .titlePaddingY }}
                  {{ if ne . 0 }}
                    {{ $lastIndex := sub (len .) 1 }}
                    {{ if eq (substr . $lastIndex) "%" }}
                      {{ $percentPadY = substr . 0 $lastIndex }}
                    {{ end }}
                  {{ end }}
                {{ end }}
                {{ range .title }}
                  {{ if $percentPadY }}
                    <div class="site-header__title {{ if $header.titleShadow }}site-header__title--shadow{{ end }}" style="font-size: {{ $header.titleFontSize }}; {{ with $header.titleColor }}color:{{ . }}{{ end }}; padding: calc({{ $height }}px * ({{ $percentPadY }} / 100)) 0;">
                  {{ else }}
                    <div class="site-header__title {{ if $header.titleShadow }}site-header__title--shadow{{ end }}" style="font-size: {{ $header.titleFontSize }}; {{ with $header.titleColor }}color:{{ . }}{{ end }}; padding: {{ $header.titlePaddingY }} 0;">
                  {{ end }}
                      {{ . }}
                    </div>
                {{ end }}
              {{ end }}

              {{/* Space */}}
              {{ with .spaceBetweenTitleSubtitle }}
                {{ if ne . 0 }}
                  {{ $val := string . }}
                  {{ $percentSpace := 0 }}
                  {{ $lastIndex := sub (len $val) 1 }}
                  {{ if eq (substr . $lastIndex) "%" }}
                    {{ $percentSpace = substr . 0 $lastIndex }}
                  {{ end }}
                  {{ if $percentSpace }}
                    <div style="height: calc({{ $height }}px * ({{ $percentSpace }} / 100)); opacity: 0;">-</div>
                  {{ else }}
                    <div style="height: {{ . }}; opacity: 0;">-</div>
                  {{ end }}
                {{ end }}
              {{ end }}

              {{/* Subtitle */}}
              {{ if .subtitle }}
                {{ $percentPadY := 0 }}
                {{ with .subtitlePaddingY }}
                  {{ $lastIndex := sub (len .) 1 }}
                  {{ if eq (substr . $lastIndex) "%" }}
                    {{ $percentPadY = substr . 0 $lastIndex }}
                  {{ end }}
                {{ end }}
                {{ range .subtitle }} 
                  {{ if $percentPadY }}
                    <div class="site-header__subtitle {{ if $header.subtitleShadow }}site-header__subtitle--shadow{{ end }}" style="font-size: {{ $header.subtitleFontSize }}; {{ with $header.subtitleColor }}color:{{ . }}{{ end }}; padding: calc({{ $height }}px * ({{ $percentPadY }} / 100)) 0;" data-cursive="{{ with $header.subtitleCursive }}{{ . }}{{ end }}">
                  {{ else }}
                    <div class="site-header__subtitle {{ if $header.subtitleShadow }}site-header__subtitle--shadow{{ end }}" style="font-size: {{ $header.subtitleFontSize }}; {{ with $header.subtitleColor }}color:{{ . }}{{ end }}; padding: {{ $header.subtitlePaddingY }} 0;" data-cursive="{{ with $header.subtitleCursive }}{{ . }}{{ end }}">
                  {{ end }}
                      {{ . }}
                    </div>
                  {{ end }}
                {{ end }}
              </div>
            </div>
          {{ end }}
        {{ end }}
      {{ end }}
    </div>
  </section>
{{ if eq $type "slide" }}
  <script type='text/javascript'>
    {{ $header := $context.Params.header }}
    var options = null;
    var header = JSON.parse({{ $header | jsonify }});
    var slide = header.filter(function(h) {
      return h.type === 'slide';
    });

    var transition_effect = "fade";
    var transition_delay = 4000;
    var transition_duration = 1000;

    if (slide.length > 0) {
      options = slide[0].options;
      if (options.hasOwnProperty('transition_effect')) {
        transition_effect = options.transition_effect;
      }
      if (options.hasOwnProperty('transition_delay')) {
        transition_delay = options.transition_delay;
      }
      if (options.hasOwnProperty('transition_duration')) {
        transition_duration = options.transition_duration;
      }
    }

    var slider_value_header = { "transition_effect": transition_effect, "transition_delay": transition_delay, "transition_duration": transition_duration };
  </script>
  {{ $jquery := resources.Get "js/jquery.js" | resources.Fingerprint }}
  <script type='text/javascript' src="{{ $jquery.RelPermalink }}"></script>
  {{ $jqueryCycle := resources.Get "js/jquery.cycle.all.min.js" | resources.Fingerprint }}
  <script type='text/javascript' src="{{ $jqueryCycle.RelPermalink }}"></script>
  {{/* 2-REC: Slider size "fix" - MID */}}
  {{ $sliderSizeFix := resources.Get "js/slider-size-fix.js" | resources.Fingerprint }}
  <script type='text/javascript' src="{{ $sliderSizeFix.RelPermalink }}"></script>
  {{/* 2-REC: Slider size "fix" - END */}}
  {{ $slider := resources.Get "js/slider-header-settings.min.js" | resources.Fingerprint }}
  <script type='text/javascript' src="{{ $slider.RelPermalink }}"></script>
{{ end }}
{{ end }}